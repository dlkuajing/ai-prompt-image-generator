<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>跨海帆-闪图 | AI智能图片生成工具</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary-gradient: linear-gradient(135deg, #6B73FF 0%, #000DFF 100%);
            --secondary-gradient: linear-gradient(135deg, #00C9FF 0%, #92FE9D 100%);
            --accent-gradient: linear-gradient(135deg, #FC466B 0%, #3F5EFB 100%);
            --dark-gradient: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            --primary-color: #6B73FF;
            --secondary-color: #00C9FF;
            --success-color: #00D9A3;
            --error-color: #FF4757;
            --text-dark: #2C3E50;
            --text-light: #5A6C7D;
            --border-light: #E8EBF0;
            --bg-light: #F8FAFB;
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.06);
            --shadow-md: 0 4px 20px rgba(0,0,0,0.08);
            --shadow-lg: 0 10px 40px rgba(0,0,0,0.12);
            --shadow-xl: 0 20px 60px rgba(0,0,0,0.15);
            --transition-fast: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-medium: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes shimmer {
            0% { background-position: -1000px 0; }
            100% { background-position: 1000px 0; }
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            min-height: 100vh;
            padding: 20px;
            position: relative;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 80%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(255, 255, 255, 0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: 1;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
            z-index: 2;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 50px;
            animation: slideInUp 0.8s ease;
        }
        
        .brand-container {
            display: inline-flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
            padding: 15px 30px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 100px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            animation: float 6s ease-in-out infinite;
        }
        
        .brand-logo {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            box-shadow: 0 4px 20px rgba(255, 215, 0, 0.4);
            transform: rotate(-5deg);
            transition: transform var(--transition-medium);
        }
        
        .brand-container:hover .brand-logo {
            transform: rotate(5deg) scale(1.1);
        }
        
        .brand-text {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .brand-name {
            font-size: 32px;
            font-weight: 800;
            background: linear-gradient(135deg, #FFFFFF 0%, #FFD700 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: 2px;
            text-shadow: 0 2px 10px rgba(255, 255, 255, 0.3);
        }
        
        .brand-tagline {
            font-size: 14px;
            opacity: 0.95;
            letter-spacing: 1px;
            margin-top: 4px;
        }
        
        .header h1 {
            display: none;
        }
        
        .header p {
            font-size: 18px;
            opacity: 0.95;
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.6;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 35px;
            margin-bottom: 25px;
            box-shadow: var(--shadow-xl);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform var(--transition-medium), box-shadow var(--transition-medium);
            animation: slideInUp 0.6s ease backwards;
        }
        
        .card:nth-child(2) { animation-delay: 0.1s; }
        .card:nth-child(3) { animation-delay: 0.2s; }
        .card:nth-child(4) { animation-delay: 0.3s; }
        
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 25px 70px rgba(0,0,0,0.15);
        }
        
        .input-group {
            margin-bottom: 25px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--text-dark);
            font-size: 15px;
            letter-spacing: 0.5px;
        }
        
        .input-group textarea {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid var(--border-light);
            border-radius: 12px;
            font-size: 15px;
            resize: vertical;
            transition: all var(--transition-fast);
            background: var(--bg-light);
            font-family: inherit;
            line-height: 1.5;
        }
        
        .input-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            background: white;
            box-shadow: 0 0 0 4px rgba(107, 115, 255, 0.1);
            transform: translateY(-1px);
        }
        
        .input-group textarea:hover {
            border-color: #D1D5DB;
        }
        
        .input-group input[type="number"] {
            width: 200px;
            padding: 12px 16px;
            border: 2px solid var(--border-light);
            border-radius: 12px;
            font-size: 15px;
            transition: all var(--transition-fast);
            background: var(--bg-light);
            font-family: inherit;
        }
        
        .input-group input[type="number"]:focus {
            outline: none;
            border-color: var(--primary-color);
            background: white;
            box-shadow: 0 0 0 4px rgba(107, 115, 255, 0.1);
        }
        
        .input-group input[type="number"]:hover {
            border-color: #D1D5DB;
        }
        
        .dimensions-container {
            margin-bottom: 25px;
        }
        
        .dimensions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 12px;
            margin-top: 15px;
        }
        
        .dimension-checkbox {
            display: flex;
            align-items: center;
            background: var(--bg-light);
            padding: 12px 14px;
            border-radius: 12px;
            cursor: pointer;
            transition: all var(--transition-fast);
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }
        
        .dimension-checkbox::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--primary-gradient);
            opacity: 0;
            transition: opacity var(--transition-fast);
        }
        
        .dimension-checkbox:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            border-color: var(--primary-color);
        }
        
        .dimension-checkbox input[type="checkbox"] {
            margin-right: 10px;
            width: 20px;
            height: 20px;
            cursor: pointer;
            position: relative;
            z-index: 1;
            accent-color: var(--primary-color);
        }
        
        .dimension-checkbox label {
            position: relative;
            z-index: 1;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-dark);
            cursor: pointer;
        }
        
        .dimension-checkbox.selected {
            background: linear-gradient(135deg, rgba(107, 115, 255, 0.1) 0%, rgba(0, 201, 255, 0.1) 100%);
            border: 2px solid var(--primary-color);
            box-shadow: 0 4px 12px rgba(107, 115, 255, 0.2);
        }
        
        .dimension-checkbox.selected::before {
            opacity: 0.05;
        }
        
        .select-controls {
            margin: 15px 0;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .select-controls button {
            padding: 8px 16px;
            background: white;
            border: 2px solid var(--border-light);
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-dark);
            transition: all var(--transition-fast);
            white-space: nowrap;
        }
        
        .select-controls button:hover {
            background: var(--bg-light);
            border-color: var(--primary-color);
            color: var(--primary-color);
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }
        
        .select-controls button:active {
            transform: translateY(0);
        }
        
        .btn {
            background: var(--primary-gradient);
            color: white;
            border: none;
            padding: 16px 36px;
            border-radius: 14px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-medium);
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(107, 115, 255, 0.3);
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left var(--transition-slow);
        }
        
        .btn:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 12px 30px rgba(107, 115, 255, 0.4);
        }
        
        .btn:hover::before {
            left: 100%;
        }
        
        .btn:active {
            transform: translateY(-1px) scale(1);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .btn:disabled:hover {
            transform: none;
            box-shadow: none;
        }
        
        .variants-container {
            margin-top: 20px;
        }
        
        .variant-card {
            background: var(--bg-light);
            padding: 18px 20px;
            border-radius: 14px;
            margin-bottom: 14px;
            position: relative;
            transition: all var(--transition-medium);
            border: 2px solid transparent;
            animation: slideInUp 0.4s ease backwards;
        }
        
        .variant-card:hover {
            transform: translateX(5px);
            background: white;
            box-shadow: var(--shadow-md);
            border-color: var(--primary-color);
        }
        
        .variant-card.selected {
            background: linear-gradient(135deg, rgba(107, 115, 255, 0.08) 0%, rgba(0, 201, 255, 0.08) 100%);
            border: 2px solid var(--primary-color);
            box-shadow: 0 6px 20px rgba(107, 115, 255, 0.15);
        }
        
        .variant-checkbox {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .variant-text {
            color: #333;
            line-height: 1.6;
            margin-left: 40px;
            margin-right: 60px;
        }
        
        .copy-btn {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            background: var(--primary-gradient);
            color: white;
            border: none;
            padding: 8px 14px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-fast);
            box-shadow: 0 2px 8px rgba(107, 115, 255, 0.2);
        }
        
        .copy-btn:hover {
            transform: translateY(-50%) scale(1.05);
            box-shadow: 0 4px 12px rgba(107, 115, 255, 0.3);
        }
        
        .copy-btn:active {
            transform: translateY(-50%) scale(0.98);
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(107, 115, 255, 0.1);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s cubic-bezier(0.68, -0.55, 0.27, 1.55) infinite;
            margin: 0 auto 25px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .success-msg {
            background: linear-gradient(135deg, #00D9A3 0%, #00f2c3 100%);
            color: white;
            padding: 16px 24px;
            border-radius: 12px;
            position: fixed;
            top: 30px;
            right: 30px;
            animation: slideIn 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            z-index: 10000;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            font-size: 15px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
            max-width: 400px;
        }
        
        .success-msg::before {
            content: '✓';
            display: flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            font-size: 16px;
            font-weight: bold;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(120%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .generate-images-btn {
            background: var(--secondary-gradient);
            margin-top: 25px;
            padding: 18px 40px;
            font-size: 17px;
            letter-spacing: 0.5px;
        }
        
        .generate-images-btn:hover {
            box-shadow: 0 12px 30px rgba(0, 201, 255, 0.4);
        }
        
        .selection-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 10px;
            background: #f0f4ff;
            border-radius: 8px;
        }
        
        .progress-bar {
            width: 100%;
            height: 24px;
            background: linear-gradient(135deg, #f0f0f0 0%, #e0e0e0 100%);
            border-radius: 12px;
            overflow: hidden;
            margin: 25px 0;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.06);
            position: relative;
        }
        
        .progress-bar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.3), 
                transparent);
            animation: shimmer 2s infinite;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--primary-gradient);
            width: 0%;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 13px;
            font-weight: 600;
            box-shadow: 0 2px 10px rgba(107, 115, 255, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.2), 
                transparent);
            animation: shimmer 2s infinite;
        }
        
        .images-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 24px;
            margin-top: 25px;
        }
        
        @keyframes imageReveal {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }
        
        .image-card {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: var(--shadow-md);
            transition: all var(--transition-medium);
            animation: imageReveal 0.6s cubic-bezier(0.4, 0, 0.2, 1) backwards;
            position: relative;
        }
        
        .image-card.loading {
            min-height: 300px;
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }
        
        .image-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: var(--shadow-xl);
        }
        
        .image-card img {
            width: 100%;
            height: 220px;
            object-fit: cover;
            cursor: pointer;
            transition: transform var(--transition-medium);
            display: block;
        }
        
        .image-card:hover img {
            transform: scale(1.05);
        }
        
        .image-info {
            padding: 16px;
            background: white;
        }
        
        .image-prompt {
            font-size: 13px;
            color: var(--text-light);
            margin-bottom: 12px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            font-weight: 500;
        }
        
        .image-actions {
            display: flex;
            gap: 10px;
        }
        
        .image-actions button {
            flex: 1;
            padding: 8px 12px;
            border: 2px solid var(--border-light);
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-dark);
            transition: all var(--transition-fast);
        }
        
        .image-actions button:hover {
            background: var(--bg-light);
            border-color: var(--primary-color);
            color: var(--primary-color);
            transform: translateY(-1px);
        }
        
        .image-actions button:active {
            transform: translateY(0);
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.9);
        }
        
        .modal-content {
            margin: auto;
            display: block;
            max-width: 90%;
            max-height: 90%;
            margin-top: 50px;
        }
        
        .close {
            position: absolute;
            top: 15px;
            right: 35px;
            color: #f1f1f1;
            font-size: 40px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close:hover {
            color: #bbb;
        }
        
        .stats-info {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            flex: 1;
            background: linear-gradient(135deg, var(--bg-light) 0%, white 100%);
            padding: 20px;
            border-radius: 16px;
            text-align: center;
            border: 2px solid var(--border-light);
            transition: all var(--transition-medium);
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, var(--primary-color) 0%, transparent 70%);
            opacity: 0;
            transition: opacity var(--transition-medium);
        }
        
        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-color);
        }
        
        .stat-card:hover::before {
            opacity: 0.05;
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: 800;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 4px;
        }
        
        .stat-label {
            font-size: 14px;
            color: var(--text-light);
            font-weight: 500;
            letter-spacing: 0.5px;
        }
        
        .ratio-option {
            display: flex;
            align-items: center;
            padding: 8px 16px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .ratio-option:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }
        
        .ratio-option input[type="radio"] {
            margin-right: 8px;
        }
        
        .ratio-option input[type="radio"]:checked + .ratio-label {
            color: #667eea;
            font-weight: 600;
        }
        
        .ratio-option:has(input:checked) {
            border-color: #667eea;
            background: #f0f4ff;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="brand-container">
                <div class="brand-logo">⚡</div>
                <div class="brand-text">
                    <div class="brand-name">跨海帆-闪图</div>
                    <div class="brand-tagline">AI智能图片生成工具</div>
                </div>
            </div>
            <h1>🎨 提示词变体与图片生成工具</h1>
            <p>输入简单描述，AI自动生成多种创意变体，批量生成高质量图片</p>
        </div>
        
        <div class="card">
            <div class="input-group">
                <label for="basePrompt">输入基础提示词</label>
                <textarea 
                    id="basePrompt" 
                    rows="4" 
                    placeholder="例如：一个男人和一个女人在吵架"
                ></textarea>
            </div>
            
            <div class="input-group">
                <label for="variantCount">生成数量</label>
                <input 
                    type="number" 
                    id="variantCount" 
                    min="1" 
                    max="20" 
                    value="8"
                    placeholder="输入1-20之间的数字"
                />
            </div>
            
            <div class="dimensions-container">
                <label style="font-weight: 600; margin-bottom: 10px; display: block;">选择变化维度</label>
                <div class="select-controls">
                    <button onclick="selectAllDimensions()">全选</button>
                    <button onclick="deselectAllDimensions()">取消全选</button>
                    <button onclick="selectRandomDimensions()">随机选择</button>
                </div>
                <div class="dimensions-grid" id="dimensionsGrid">
                    <!-- 维度选项将动态加载 -->
                </div>
            </div>
            
            <button class="btn" id="generateBtn" onclick="generateVariants()">
                生成变体
            </button>
        </div>
        
        <div class="card" id="statsCard" style="display: none;">
            <div class="stats-info">
                <div class="stat-card">
                    <div class="stat-value" id="totalVariants">0</div>
                    <div class="stat-label">生成变体数</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="selectedVariants">0</div>
                    <div class="stat-label">已选择变体</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="generatedImages">0</div>
                    <div class="stat-label">生成图片数</div>
                </div>
            </div>
        </div>
        
        <div class="card" id="resultsCard" style="display: none;">
            <h2 style="margin-bottom: 20px;">生成的变体</h2>
            <div class="selection-info">
                <div>
                    <button onclick="selectAllVariants()">全选</button>
                    <button onclick="deselectAllVariants()">取消全选</button>
                </div>
                <div>
                    已选择: <span id="selectedCount">0</span> / <span id="totalCount">0</span>
                </div>
            </div>
            <div id="variantsContainer" class="variants-container"></div>
            
            <!-- 添加图片比例选择 -->
            <div style="margin-top: 20px; padding: 15px; background: #f0f4ff; border-radius: 8px;">
                <label style="font-weight: 600; display: block; margin-bottom: 10px;">选择图片比例：</label>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <label class="ratio-option">
                        <input type="radio" name="aspectRatio" value="1:1" checked>
                        <span class="ratio-label">1:1 (正方形)</span>
                    </label>
                    <label class="ratio-option">
                        <input type="radio" name="aspectRatio" value="9:16">
                        <span class="ratio-label">9:16 (竖屏)</span>
                    </label>
                    <label class="ratio-option">
                        <input type="radio" name="aspectRatio" value="16:9">
                        <span class="ratio-label">16:9 (横屏)</span>
                    </label>
                    <label class="ratio-option">
                        <input type="radio" name="aspectRatio" value="3:4">
                        <span class="ratio-label">3:4 (竖版)</span>
                    </label>
                    <label class="ratio-option">
                        <input type="radio" name="aspectRatio" value="4:3">
                        <span class="ratio-label">4:3 (横版)</span>
                    </label>
                </div>
            </div>
            
            <button class="btn generate-images-btn" onclick="generateImages()">
                批量生成图片
            </button>
        </div>
        
        <div class="card" id="imagesCard" style="display: none;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="margin: 0;">生成的图片</h2>
                <button class="btn" id="downloadAllBtn" onclick="downloadAllImages()" style="background: #52c41a;">
                    📥 下载所有图片
                </button>
            </div>
            <div class="progress-bar" id="progressBar" style="display: none;">
                <div class="progress-fill" id="progressFill">0%</div>
            </div>
            <div class="images-grid" id="imagesGrid"></div>
        </div>
        
        <div class="card" id="loadingCard" style="display: none;">
            <div class="loading">
                <div class="spinner"></div>
                <p id="loadingText">正在生成变体，请稍候...</p>
            </div>
        </div>
    </div>
    
    <!-- 图片预览模态框 -->
    <div id="imageModal" class="modal">
        <span class="close" onclick="closeModal()">&times;</span>
        <img class="modal-content" id="modalImage">
    </div>
    
    <script>
        // 维度选项
        const dimensions = [
            '场景', '动作', '穿着', '光影', '站位', '情绪', '构图',
            '色调', '风格', '时间', '天气', '角度', '特效', 
            '材质', '纹理', '氛围', '细节', '背景'
        ];
        
        let selectedDimensions = new Set(['场景', '动作', '穿着', '光影', '站位', '情绪', '构图']);
        let variantsList = [];
        let selectedVariantIndices = new Set();
        let generatedImageIds = [];  // 存储生成的图片ID
        
        // 初始化维度选择器
        function initDimensions() {
            const grid = document.getElementById('dimensionsGrid');
            grid.innerHTML = '';
            
            dimensions.forEach(dim => {
                const div = document.createElement('div');
                div.className = 'dimension-checkbox' + (selectedDimensions.has(dim) ? ' selected' : '');
                div.innerHTML = `
                    <input type="checkbox" id="dim-${dim}" value="${dim}" 
                           ${selectedDimensions.has(dim) ? 'checked' : ''}
                           onchange="toggleDimension('${dim}')">
                    <label for="dim-${dim}">${dim}</label>
                `;
                grid.appendChild(div);
            });
        }
        
        function toggleDimension(dim) {
            const checkbox = document.getElementById(`dim-${dim}`);
            const parent = checkbox.parentElement;
            
            if (checkbox.checked) {
                selectedDimensions.add(dim);
                parent.classList.add('selected');
            } else {
                selectedDimensions.delete(dim);
                parent.classList.remove('selected');
            }
        }
        
        function selectAllDimensions() {
            dimensions.forEach(dim => {
                selectedDimensions.add(dim);
                const checkbox = document.getElementById(`dim-${dim}`);
                if (checkbox) {
                    checkbox.checked = true;
                    checkbox.parentElement.classList.add('selected');
                }
            });
        }
        
        function deselectAllDimensions() {
            selectedDimensions.clear();
            dimensions.forEach(dim => {
                const checkbox = document.getElementById(`dim-${dim}`);
                if (checkbox) {
                    checkbox.checked = false;
                    checkbox.parentElement.classList.remove('selected');
                }
            });
        }
        
        function selectRandomDimensions() {
            deselectAllDimensions();
            const randomCount = Math.floor(Math.random() * 5) + 5; // 5-10个维度
            const shuffled = [...dimensions].sort(() => Math.random() - 0.5);
            shuffled.slice(0, randomCount).forEach(dim => {
                selectedDimensions.add(dim);
                const checkbox = document.getElementById(`dim-${dim}`);
                if (checkbox) {
                    checkbox.checked = true;
                    checkbox.parentElement.classList.add('selected');
                }
            });
        }
        
        async function generateVariants() {
            const basePrompt = document.getElementById('basePrompt').value.trim();
            const variantCount = parseInt(document.getElementById('variantCount').value) || 8;
            
            if (!basePrompt) {
                showMessage('请输入基础提示词', 'error');
                return;
            }
            
            if (selectedDimensions.size === 0) {
                showMessage('请至少选择一个变化维度', 'error');
                return;
            }
            
            // 显示加载状态
            document.getElementById('loadingCard').style.display = 'block';
            document.getElementById('resultsCard').style.display = 'none';
            document.getElementById('statsCard').style.display = 'none';
            document.getElementById('imagesCard').style.display = 'none';
            document.getElementById('generateBtn').disabled = true;
            
            try {
                // 调用后端API
                const response = await fetch('http://localhost:8000/api/variants/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        base_prompt: basePrompt,
                        dimensions: Array.from(selectedDimensions),
                        count: variantCount
                    })
                });
                
                if (!response.ok) {
                    throw new Error('API请求失败');
                }
                
                const data = await response.json();
                variantsList = data.variants;
                
                displayVariants(variantsList);
                updateStats();
                
                document.getElementById('loadingCard').style.display = 'none';
                document.getElementById('resultsCard').style.display = 'block';
                document.getElementById('statsCard').style.display = 'block';
                
                showMessage(`成功生成${variantsList.length}个变体！`);
                
            } catch (error) {
                console.error('Error:', error);
                // 使用备用方案
                generateVariantsOffline(basePrompt, variantCount);
            } finally {
                document.getElementById('generateBtn').disabled = false;
            }
        }
        
        function generateVariantsOffline(basePrompt, count) {
            // 离线生成变体（备用方案）
            const templates = [
                'in a modern coffee shop, warm ambient lighting, casual contemporary clothing',
                'at golden hour sunset, dramatic backlighting, formal business attire',
                'in heavy rain on city street, moody blue lighting, rain-soaked clothes',
                'in minimalist white room, soft diffused lighting, elegant designer outfits',
                'in bustling urban park, natural daylight, sporty casual wear',
                'in dimly lit restaurant, candlelight ambiance, evening formal wear',
                'on rooftop at night, neon city lights background, street fashion',
                'in home living room, warm domestic lighting, comfortable home clothes'
            ];
            
            variantsList = [];
            for (let i = 0; i < count && i < templates.length; i++) {
                variantsList.push(`${basePrompt} ${templates[i]}`);
            }
            
            displayVariants(variantsList);
            updateStats();
            
            document.getElementById('loadingCard').style.display = 'none';
            document.getElementById('resultsCard').style.display = 'block';
            document.getElementById('statsCard').style.display = 'block';
            
            showMessage(`成功生成${variantsList.length}个变体！`);
        }
        
        function displayVariants(variants) {
            const container = document.getElementById('variantsContainer');
            container.innerHTML = '';
            selectedVariantIndices.clear();
            
            variants.forEach((variant, index) => {
                const variantCard = document.createElement('div');
                variantCard.className = 'variant-card';
                variantCard.innerHTML = `
                    <input type="checkbox" class="variant-checkbox" 
                           id="variant-${index}" 
                           onchange="toggleVariantSelection(${index})">
                    <div class="variant-text">${variant}</div>
                    <button class="copy-btn" onclick="copyToClipboard(variantsList[${index}])">
                        复制
                    </button>
                `;
                container.appendChild(variantCard);
            });
            
            document.getElementById('totalCount').textContent = variants.length;
            updateSelectionCount();
        }
        
        function toggleVariantSelection(index) {
            const checkbox = document.getElementById(`variant-${index}`);
            const card = checkbox.parentElement;
            
            if (checkbox.checked) {
                selectedVariantIndices.add(index);
                card.classList.add('selected');
            } else {
                selectedVariantIndices.delete(index);
                card.classList.remove('selected');
            }
            
            updateSelectionCount();
        }
        
        function selectAllVariants() {
            variantsList.forEach((_, index) => {
                selectedVariantIndices.add(index);
                const checkbox = document.getElementById(`variant-${index}`);
                if (checkbox) {
                    checkbox.checked = true;
                    checkbox.parentElement.classList.add('selected');
                }
            });
            updateSelectionCount();
        }
        
        function deselectAllVariants() {
            selectedVariantIndices.clear();
            variantsList.forEach((_, index) => {
                const checkbox = document.getElementById(`variant-${index}`);
                if (checkbox) {
                    checkbox.checked = false;
                    checkbox.parentElement.classList.remove('selected');
                }
            });
            updateSelectionCount();
        }
        
        function updateSelectionCount() {
            document.getElementById('selectedCount').textContent = selectedVariantIndices.size;
            document.getElementById('selectedVariants').textContent = selectedVariantIndices.size;
        }
        
        function updateStats() {
            document.getElementById('totalVariants').textContent = variantsList.length;
            document.getElementById('selectedVariants').textContent = selectedVariantIndices.size;
        }
        
        async function generateImages() {
            if (selectedVariantIndices.size === 0) {
                showMessage('请选择要生成图片的变体', 'error');
                return;
            }
            
            const selectedPrompts = Array.from(selectedVariantIndices).map(i => variantsList[i]);
            const aspectRatio = document.querySelector('input[name="aspectRatio"]:checked').value;
            
            document.getElementById('loadingCard').style.display = 'none'; // 隐藏加载卡片
            document.getElementById('imagesCard').style.display = 'block';
            document.getElementById('progressBar').style.display = 'block';
            
            const imagesGrid = document.getElementById('imagesGrid');
            imagesGrid.innerHTML = '';
            generatedImageIds = [];  // 重置图片ID列表
            
            // 预先创建占位卡片
            selectedPrompts.forEach((prompt, index) => {
                const placeholderCard = createImagePlaceholder(index);
                imagesGrid.appendChild(placeholderCard);
            });
            
            try {
                // 实时生成图片的新方法
                const totalImages = selectedPrompts.length;
                let completedImages = 0;
                
                // 使用Promise.all并发生成，但逐个显示结果
                const imagePromises = selectedPrompts.map(async (prompt, index) => {
                    try {
                        // 调用单个图片生成API
                        const response = await fetch('http://localhost:8000/api/images/generate', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                prompts: [prompt],  // 单个提示词
                                aspect_ratio: aspectRatio
                            })
                        });
                        
                        if (!response.ok) {
                            throw new Error(`图片 ${index + 1} 生成失败`);
                        }
                        
                        const data = await response.json();
                        
                        if (data.images && data.images.length > 0) {
                            const image = data.images[0];
                            
                            // 实时替换占位符为真实图片
                            const placeholderCard = imagesGrid.children[index];
                            const realCard = createImageCard(image.url, image.prompt, index);
                            imagesGrid.replaceChild(realCard, placeholderCard);
                            
                            if (image.id) {
                                generatedImageIds.push(image.id);
                            }
                            
                            completedImages++;
                            updateProgress((completedImages / totalImages) * 100);
                            document.getElementById('generatedImages').textContent = completedImages;
                        }
                    } catch (error) {
                        console.error(`Error generating image ${index + 1}:`, error);
                        // 对于失败的图片，显示错误状态
                        const placeholderCard = imagesGrid.children[index];
                        placeholderCard.classList.remove('loading');
                        placeholderCard.innerHTML = `
                            <div style="padding: 40px; text-align: center; color: var(--error-color);">
                                <div style="font-size: 48px; margin-bottom: 10px;">❌</div>
                                <div>生成失败</div>
                            </div>
                        `;
                        completedImages++;
                        updateProgress((completedImages / totalImages) * 100);
                    }
                });
                
                // 等待所有图片生成完成
                await Promise.all(imagePromises);
                
                showMessage(`成功生成${generatedImageIds.length}张图片！`);
                
                // 显示下载按钮
                document.getElementById('downloadAllBtn').style.display = generatedImageIds.length > 0 ? 'block' : 'none';
                
            } catch (error) {
                console.error('Error:', error);
                showMessage('图片生成过程中出现错误', 'error');
            } finally {
                setTimeout(() => {
                    document.getElementById('progressBar').style.display = 'none';
                }, 1000);
            }
        }
        
        function createImagePlaceholder(index) {
            const card = document.createElement('div');
            card.className = 'image-card loading';
            card.style.animationDelay = `${index * 0.1}s`;
            card.innerHTML = `
                <div style="padding: 40px; text-align: center;">
                    <div class="spinner" style="margin: 40px auto;"></div>
                    <div style="color: var(--text-light);">正在生成图片 ${index + 1}...</div>
                </div>
            `;
            return card;
        }
        
        function createImageCard(url, prompt, index) {
            const imageCard = document.createElement('div');
            imageCard.className = 'image-card';
            imageCard.style.animationDelay = `${index * 0.1}s`;
            
            const img = document.createElement('img');
            img.src = url;
            img.alt = prompt;
            img.onclick = () => openModal(url);
            img.loading = 'lazy';
            
            const infoDiv = document.createElement('div');
            infoDiv.className = 'image-info';
            
            const promptDiv = document.createElement('div');
            promptDiv.className = 'image-prompt';
            promptDiv.title = prompt;
            promptDiv.textContent = prompt;
            
            const actionsDiv = document.createElement('div');
            actionsDiv.className = 'image-actions';
            
            const downloadBtn = document.createElement('button');
            downloadBtn.textContent = '下载';
            downloadBtn.onclick = () => downloadImage(url, `image_${index + 1}.png`);
            
            const copyBtn = document.createElement('button');
            copyBtn.textContent = '复制提示词';
            copyBtn.onclick = () => copyToClipboard(prompt);
            
            actionsDiv.appendChild(downloadBtn);
            actionsDiv.appendChild(copyBtn);
            infoDiv.appendChild(promptDiv);
            infoDiv.appendChild(actionsDiv);
            imageCard.appendChild(img);
            imageCard.appendChild(infoDiv);
            
            return imageCard;
        }
        
        function generatePlaceholderImages(prompts) {
            const imagesGrid = document.getElementById('imagesGrid');
            imagesGrid.innerHTML = '';
            
            prompts.forEach((prompt, index) => {
                setTimeout(() => {
                    updateProgress((index + 1) / prompts.length * 100);
                    const placeholderUrl = `https://via.placeholder.com/400x300/667eea/ffffff?text=Image+${index + 1}`;
                    const imageCard = createImageCard(placeholderUrl, prompt, index);
                    imagesGrid.appendChild(imageCard);
                    document.getElementById('generatedImages').textContent = index + 1;
                }, index * 200); // 逐个显示，每个间隔200ms
            });
            
            setTimeout(() => {
                showMessage(`已生成${prompts.length}张占位图片（API暂时不可用）`, 'info');
            }, prompts.length * 200);
        }
        
        // 已经被 createImageCard 替代，保留空函数以避免错误
        function displayImage(url, prompt) {
            // Deprecated - use createImageCard instead
        }
        
        function updateProgress(percent) {
            const progressFill = document.getElementById('progressFill');
            progressFill.style.width = percent + '%';
            progressFill.textContent = Math.round(percent) + '%';
        }
        
        function openModal(imageUrl) {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');
            modal.style.display = 'block';
            modalImg.src = imageUrl;
        }
        
        function closeModal() {
            document.getElementById('imageModal').style.display = 'none';
        }
        
        function downloadImage(url, filename) {
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
        }
        
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showMessage('已复制到剪贴板');
            });
        }
        
        async function downloadAllImages() {
            if (generatedImageIds.length === 0) {
                showMessage('没有可下载的图片', 'error');
                return;
            }
            
            showMessage('正在打包图片，请稍候...', 'info');
            
            try {
                const response = await fetch('http://localhost:8000/api/images/download', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(generatedImageIds)
                });
                
                if (!response.ok) {
                    throw new Error('下载失败');
                }
                
                // 下载文件
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `images_batch_${new Date().getTime()}.zip`;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
                
                showMessage(`成功下载${generatedImageIds.length}张图片！`);
            } catch (error) {
                console.error('Error:', error);
                showMessage('批量下载失败，请重试', 'error');
            }
        }
        
        function showMessage(text, type = 'success') {
            const msg = document.createElement('div');
            msg.className = 'success-msg';
            
            // 根据类型设置不同的样式和图标
            let icon = '✓';
            if (type === 'error') {
                msg.style.background = 'linear-gradient(135deg, #FF4757 0%, #ff6b7a 100%)';
                icon = '✕';
            } else if (type === 'info') {
                msg.style.background = 'linear-gradient(135deg, #1890ff 0%, #40a9ff 100%)';
                icon = 'ℹ';
            } else {
                msg.style.background = 'linear-gradient(135deg, #00D9A3 0%, #00f2c3 100%)';
            }
            
            // 设置自定义图标
            msg.style.setProperty('--msg-icon', `'${icon}'`);
            const style = document.createElement('style');
            style.textContent = `.success-msg::before { content: var(--msg-icon, '✓'); }`;
            document.head.appendChild(style);
            
            msg.textContent = text;
            document.body.appendChild(msg);
            
            setTimeout(() => {
                msg.style.opacity = '0';
                msg.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    msg.remove();
                    style.remove();
                }, 300);
            }, 3000);
        }
        
        // Enter键触发生成
        document.getElementById('basePrompt').addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                generateVariants();
            }
        });
        
        // 点击模态框外部关闭
        window.onclick = function(event) {
            const modal = document.getElementById('imageModal');
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        }
        
        // 初始化
        initDimensions();
    </script>
</body>
</html>