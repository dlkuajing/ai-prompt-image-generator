# 提示词变体与图片生成工具

## 功能特性

### 1. 增强的变体维度
- **18个可选维度**：场景、动作、穿着、光影、站位、情绪、构图、色调、风格、时间、天气、角度、特效、材质、纹理、氛围、细节、背景
- **灵活选择**：用户可以自由选择要使用的维度
- **智能组合**：系统会根据选择的维度智能生成变体

### 2. 数量控制
- **变体数量**：支持1-20个变体生成
- **默认值**：默认生成8个变体
- **批量处理**：支持批量选择和批量生成

### 3. Gemini API集成
- **文本模型**：使用gemini-2.0-flash-exp生成变体
- **图像模型**：使用imagen-3.0-flash-001生成图片
- **API Key**：已配置（AIzaSyB-ZYo5kMjtpqnOyjEELzy8PD8VnMTuvkw）

### 4. 图片生成功能
- **批量生成**：选择多个变体批量生成图片
- **进度显示**：实时显示生成进度
- **图片预览**：支持点击查看大图
- **下载功能**：支持单独下载每张图片

### 5. 用户体验优化
- **加载动画**：优雅的加载状态显示
- **进度条**：图片生成进度实时更新
- **错误处理**：友好的错误提示
- **批量操作**：全选/取消全选功能
- **统计信息**：显示总数和已选择数量

## 安装和运行

### 1. 安装依赖
```bash
cd backend
pip install fastapi uvicorn aiohttp pydantic
```

### 2. 启动后端服务
```bash
cd backend
python main.py
```
服务将运行在 http://localhost:8000

### 3. 打开前端页面
在浏览器中打开 `/Users/c.joelin/Desktop/跨海帆-闪图/index.html`

## 使用说明

### 基本流程
1. **输入基础提示词**：在文本框中输入你的基础提示词
2. **设置生成数量**：选择要生成的变体数量（1-20个）
3. **选择变化维度**：勾选要使用的变化维度
4. **生成变体**：点击"生成变体"按钮
5. **选择变体**：从生成的变体中选择要生成图片的项
6. **生成图片**：点击"批量生成图片"按钮
7. **查看和下载**：预览生成的图片并下载

### 测试功能
运行测试脚本验证所有功能：
```bash
cd backend
python test_api.py
```

## API接口说明

### 1. 健康检查
- **GET** `/api/health`
- 返回服务健康状态

### 2. 获取维度列表
- **GET** `/api/dimensions`
- 返回所有可用的变化维度

### 3. 生成变体
- **POST** `/api/generate-variants`
- 请求体：
  ```json
  {
    "base_prompt": "基础提示词",
    "dimensions": ["场景", "动作", "光影"],
    "count": 8
  }
  ```

### 4. 生成图片
- **POST** `/api/generate-images`
- 请求体：
  ```json
  {
    "prompts": ["提示词1", "提示词2"],
    "aspect_ratio": "1:1",
    "number_of_images": 1
  }
  ```

### 5. 获取图片
- **GET** `/api/images/{image_id}`
- 返回生成的图片文件

## 注意事项

1. **API限制**：Gemini API有调用频率限制，建议适度使用
2. **备用机制**：当API调用失败时，系统会使用预设模板生成变体
3. **图片存储**：生成的图片保存在 `backend/storage/images/` 目录
4. **占位图片**：API失败时会返回占位图片，方便调试

## 项目结构
```
跨海帆-闪图/
├── index.html          # 前端页面
├── backend/
│   ├── main.py        # FastAPI后端主程序
│   ├── test_api.py    # API测试脚本
│   ├── README.md      # 本文档
│   └── storage/
│       ├── images/    # 生成的图片存储
│       └── temp/      # 临时文件
```

## 技术栈
- **前端**：HTML5, CSS3, JavaScript (原生)
- **后端**：Python, FastAPI, Uvicorn
- **AI服务**：Google Gemini API
- **异步处理**：aiohttp, asyncio

## 更新日志
- 2025-01-10：完成所有功能实现
  - 添加18个变化维度
  - 实现数量控制（1-20）
  - 集成Gemini API
  - 实现批量图片生成
  - 优化用户界面和体验